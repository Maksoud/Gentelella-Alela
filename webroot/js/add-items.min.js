jQuery(document).ready(function(e){function t(e){var t=!1;e<0&&(t=!0),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0,0$1"):2==u?e=e.replace(/(\d)/,"0,$1"):u>2&&u<=5?e=e.replace(/(\d{2})$/,",$1"):u>5&&(e=e.replace(/(\d{2})$/,",$1").replace(/\d(?=(?:\d{3})+(?:\D|$))/g,"$&.")),t&&(e="-"+e),e}function u(e){var t=!1;e<0&&(t=!0),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0,000$1"):2==u?e=e.replace(/(\d)/,"0,00$1"):3==u?e=e.replace(/(\d)/,"0,0$1"):4==u?e=e.replace(/(\d{4})$/,"0,$1"):u>4&&(e=e.replace(/(\d{4})$/,",$1")),t&&(e="-"+e),e}function r(e){var t=!1;-1!==e.search("-")&&(t=!0,console.log("Atenção: Valor negativo!")),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0.0$1"):2==u?e=e.replace(/(\d)/,"0.$1"):u>2&&(e=e.replace(/(\d{2})$/,".$1")),t&&(e="-"+e),e}function l(e){var t=!1;-1!==e.search("-")&&(t=!0,console.log("Atenção: Valor negativo!")),e=e.replace(/\D/g,"");var u=(e=new String(Number(e))).length;return 1==u?e=e.replace(/(\d)/,"0.000$1"):2==u?e=e.replace(/(\d)/,"0.00$1"):3==u?e=e.replace(/(\d)/,"0.0$1"):4==u?e=e.replace(/(\d{4})$/,"0.$1"):u>4&&(e=e.replace(/(\d{4})$/,".$1")),t&&(e="-"+e),e}var a=0;function o(e,u,r){var l=document.querySelector("#totalproducts"),a=document.querySelector("#vltotalproducts"),o=document.querySelector("#totalipi"),n=document.querySelector("#vltotalipi"),d=document.querySelector("#totalicms"),c=document.querySelector("#vltotalicms"),v=document.querySelector("#totaldiscount"),m=document.querySelector("#vltotaldiscount"),s=document.querySelector("#grandtotal"),p=document.querySelector("#vlgrandtotal"),b=Number(a.value),y=Number(n.value),N=Number(c.value),S=Number(m.value),g=Number(p.value),_=0;for(i=0;i<e.length;i++){var x=e[i].getElementsByTagName("input");for(ii=0;ii<x.length;ii++)switch(id=x[ii].id,va=x[ii].value,id){case"list_id_product":case"list_product":case"list_unity":break;case"list_quantity":_=Number(va)}}for(i=0;i<u.length;i++)for(x=u[i].getElementsByTagName("input"),ii=0;ii<x.length;ii++)switch(id=x[ii].id,va=x[ii].value,id){case"list_vlunity":a.value=r?Number(b-Number(_*va)).toFixed(2):Number(b+Number(_*va)).toFixed(2),l.innerHTML=t(String(Number(a.value).toFixed(2)));break;case"list_vldiscount":m.value=r?Number(S-Number(va)).toFixed(2):Number(S+Number(va)).toFixed(2),v.innerHTML=t(String(Number(m.value).toFixed(2)));break;case"list_icms":c.value=r?Number(N-Number(va)).toFixed(2):Number(N+Number(va)).toFixed(2),d.innerHTML=t(String(Number(c.value).toFixed(2)));break;case"list_ipi":n.value=r?Number(y-Number(va)).toFixed(2):Number(y+Number(va)).toFixed(2),o.innerHTML=t(String(Number(n.value).toFixed(2)));break;case"list_vltotal":p.value=r?Number(g-Number(va)).toFixed(2):Number(g+Number(va)).toFixed(2),s.innerHTML=t(String(Number(p.value).toFixed(2)))}}AddTableRow=function(){var i=document.querySelector("#products_id"),n=document.querySelector("#products_title"),d=document.querySelector("#edt_imobilizado"),c=document.querySelector("#edt_unity"),v=document.querySelector("#edt_quantity"),m=document.querySelector("#edt_vlunity"),s=document.querySelector("#edt_vldiscount"),p=document.querySelector("#edt_ipi"),b=document.querySelector("#edt_peripi"),y=document.querySelector("#edt_icms"),N=document.querySelector("#edt_pericms");if(""!=v.value?qtd=Number(l(v.value)).toFixed(4):qtd=0,""==n.value)return alert("Produto não informado"),!1;if(""==c.value)return alert("Unidade não informada"),!1;if(qtd<1e-4)return alert("Quantidade não informada"),!1;if(""==m.value)return alert("Valor unitário não informado"),!1;if(""==s.value)return alert("Valor desconto não informado"),!1;if(""==p.value&&""==b.value)return alert("IPI não informado"),!1;if(""==y.value&&""==N.value)return alert("ICMS não informado"),!1;""==y.value||N.value,""==p.value||b.value,m.value=Number(l(m.value)).toFixed(4),s.value=Number(r(s.value)).toFixed(2),p.value=Number(r(p.value)).toFixed(2),b.value=Number(r(b.value)).toFixed(2),y.value=Number(r(y.value)).toFixed(2),N.value=Number(r(N.value)).toFixed(2);var S,g,_,x=Number(qtd)*Number(m.value)-Number(s.value)+Number(p.value),q=e('<tr style="font-size: 11px;">');S='<td colspan="4" class="text-nowrap">\n<input type="hidden" name="ProductList['+a+'][products_id]" id="list_id_product" value="'+i.value+'">\n<input type="hidden" name="ProductList['+a+'][products_title]" id="list_product" value="'+n.value+'">\n<input type="hidden" name="ProductList['+a+'][imobilizado]" id="list_imobilizado" value="'+d.checked+'">\n&nbsp;'+i.value+" - "+n.value+"</td>",g='<td class="text-center">\n<input type="hidden" name="ProductList['+a+'][unity]" id="list_unity" value="'+c.value+'">\n&nbsp;'+c.value+"</td>",_='<td class="text-center">\n<input type="hidden" name="ProductList['+a+'][quantity]" id="list_quantity" value="'+String(qtd)+'">\n&nbsp;'+u(String(qtd))+"</td>";var F=q.append(S+g+_+'<td rowspan="2" class="text-center bg-gray" style="padding:12px;">\n<button onclick="EditTableRow(this)" type="button" class="btn btn-actions fa fa-pencil" style="vertical-align: middle;" title="Editar"></button>\n<button onclick="RemoveTableRow(this)" type="button" class="btn btn-actions fa fa-trash" style="vertical-align: middle;" title="Excluir"></button>\n    </td>');e("#products-table").append(q);var h,f,$,k,L,w=e('<tr style="font-size: 11px;">');h='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][vlunity]" id="list_vlunity" value="'+String(Number(m.value).toFixed(4))+'">\n&nbsp;'+u(String(Number(m.value).toFixed(4)))+"</td>",f='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][vldiscount]" id="list_vldiscount" value="'+String(s.value)+'">\n&nbsp;'+t(String(Number(s.value).toFixed(2)))+"</td>",$='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][ipi]" id="list_ipi" value="'+String(p.value)+'">\n<input type="hidden" name="ProductList['+a+'][peripi]" id="list_peripi" value="'+String(b.value)+'">\n&nbsp;'+t(String(Number(p.value).toFixed(2)))+" ("+t(String(Number(b.value).toFixed(2)))+")</td>",k='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][icms]" id="list_icms" value="'+String(y.value)+'">\n<input type="hidden" name="ProductList['+a+'][pericms]" id="list_pericms" value="'+String(N.value)+'">\n&nbsp;'+t(String(Number(y.value).toFixed(2)))+" ("+t(String(Number(N.value).toFixed(2)))+")</td>",L='<td class="text-right">\n<input type="hidden" name="ProductList['+a+'][vltotal]" id="list_vltotal" value="'+String(Number(x).toFixed(2))+'">\n&nbsp;'+t(String(Number(x).toFixed(2)))+"</td>";var T=w.append(h+f+k+$+L);e("#products-table").append(w),o(F[0].cells,T[0].cells,!1),a+=1,i.value="",n.value="",d.checked=!1,c.value="UN",v.value="",m.value="",s.value="",p.value="",b.value="",y.value="",N.value=""},EditTableRow=function(a){var o=document.querySelector("#products_id"),n=document.querySelector("#products_title"),d=document.querySelector("#edt_imobilizado"),c=document.querySelector("#edt_unity"),v=document.querySelector("#edt_quantity"),m=document.querySelector("#edt_vlunity"),s=document.querySelector("#edt_vldiscount"),p=document.querySelector("#edt_ipi"),b=document.querySelector("#edt_peripi"),y=document.querySelector("#edt_icms"),N=document.querySelector("#edt_pericms");v.value=Number(l(v.value)).toFixed(4),m.value=Number(l(m.value)).toFixed(4),s.value=Number(r(s.value)).toFixed(2),p.value=Number(r(p.value)).toFixed(2),b.value=Number(r(b.value)).toFixed(2),y.value=Number(r(y.value)).toFixed(2),N.value=Number(r(N.value)).toFixed(2);var S=e(a).closest("tr"),g=S[0].cells,_=S.next("tr")[0].cells;for(i=0;i<g.length;i++){var x=g[i].getElementsByTagName("input");for(ii=0;ii<x.length;ii++)switch(id=x[ii].id,va=x[ii].value,id){case"list_id_product":o.value=va;break;case"list_product":n.value=String(va);break;case"list_imobilizado":d.checked=va;break;case"list_unity":c.value=String(va);break;case"list_quantity":v.value=u(String(va))}}for(i=0;i<_.length;i++)for(x=_[i].getElementsByTagName("input"),ii=0;ii<x.length;ii++)switch(id=x[ii].id,va=x[ii].value,id){case"list_vlunity":m.value=u(String(va));break;case"list_vldiscount":s.value=t(String(va));break;case"list_ipi":p.value=t(String(va));break;case"list_peripi":b.value=t(String(100*va));break;case"list_icms":y.value=t(String(va));break;case"list_pericms":N.value=t(String(100*va))}RemoveTableRow(a)},RemoveTableRow=function(t){var u=e(t).closest("tr");return o(u[0].cells,u.next("tr")[0].cells,!0),u.fadeOut(350,function(){e(this).closest("tr").next().remove(),e(this).closest("tr").remove()}),!1};var n=e("input[name='ipi']"),d=e("input[name='peripi']");n.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_peripi"),o=0,n=0,d=0,c=0,v=0;try{e.value&&(o=Number(l(e.value)).toFixed(4)),u.value&&(n=Number(l(u.value)).toFixed(4)),i.value&&(d=Number(r(i.value)).toFixed(2)),a.value&&(c=Number(r(a.value)).toFixed(2)),totalproducts=o*n,d>0&&!c&&(v=t(String(Number(100*d/Number(totalproducts)).toFixed(2))),a.value=v)}catch(e){console.log(e.message)}}),d.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_peripi"),o=0,n=0,d=0,c=0,v=0;try{e.value&&(o=Number(l(e.value)).toFixed(4)),u.value&&(n=Number(l(u.value)).toFixed(4)),i.value&&(d=Number(r(i.value)).toFixed(2)),a.value&&(c=Number(r(a.value)).toFixed(2)),totalproducts=o*n,c>0&&!d&&(v=t(String(Number(Number(totalproducts)*(c/100)).toFixed(2))),i.value=v)}catch(e){console.log(e.message)}});var c=e("input[name='icms']"),v=e("input[name='pericms']");c.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_icms"),o=document.querySelector("#edt_pericms"),n=document.querySelector("#edt_imobilizado"),d=0,c=0,v=0,m=0,s=0,p=0;try{e.value&&(d=Number(l(e.value)).toFixed(4)),u.value&&(c=Number(l(u.value)).toFixed(4)),i.value&&(v=Number(r(i.value)).toFixed(2)),a.value&&(m=Number(r(a.value)).toFixed(2)),o.value&&(s=Number(r(o.value)).toFixed(2)),totalproducts=d*c,s&&0!=s||(m>0&&!n.checked?(p=t(String(Number(100*m/Number(totalproducts)).toFixed(2))),o.value=p):m>0&&n.checked&&(p=t(String(Number(100*m/(Number(totalproducts)+Number(v))).toFixed(2))),o.value=p))}catch(e){console.log(e.message)}}),v.on("focusout",function(){var e=document.querySelector("#edt_quantity"),u=document.querySelector("#edt_vlunity"),i=document.querySelector("#edt_ipi"),a=document.querySelector("#edt_icms"),o=document.querySelector("#edt_pericms"),n=document.querySelector("#edt_imobilizado"),d=0,c=0,v=0,m=0,s=0,p=0;try{e.value&&(d=Number(l(e.value)).toFixed(4)),u.value&&(c=Number(l(u.value)).toFixed(4)),i.value&&(v=Number(r(i.value)).toFixed(2)),a.value&&(m=Number(r(a.value)).toFixed(2)),o.value&&(s=Number(r(o.value)).toFixed(2)),totalproducts=d*c,m&&0!=m||(s>0&&!n.checked?(p=t(String(Number(Number(totalproducts)*(s/100)).toFixed(2))),a.value=p):s>0&&n.checked&&(p=t(String(Number((Number(totalproducts)+Number(v))*(s/100)).toFixed(2))),a.value=p))}catch(e){console.log(e.message)}})});